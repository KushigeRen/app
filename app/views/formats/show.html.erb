<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div class="container">
        <%= turbo_frame_tag @group do %>
            <div class="col-12">
                グループ名：<%= @group.group_name %>
                <%= link_to '編集', edit_group_format_path(id: @group.group_id) %>
            </div>
        <% end %>
        <p class="mt-3 mb-0">メンバー</p>
        <%= link_to '追加', add_member_format_path(id: @group.group_id), data: { turbo_frame: dom_id(Member.new) } %>
        <div id="members">
            <%= turbo_frame_tag Member.new %>
            <% @members.each do |member| %>
                <%= render partial: "formats/member", locals: { member: member } %>
            <% end %>
        </div>
        <p class="mt-3 mb-0">支払い明細</p>
        <select id="members">
            <option value="" id="member">Select a member</option>
            <%= options_for_select(@members.map { |member| [member.member_name, member.member_name] }) %>
        </select>
        <% @payments.each do |payment| %>
            <%= turbo_frame_tag payment do %>
                <div class="payment">
                    <span id="creditor_member"><%= payment.creditor_member.member_name %></span>⇨
                    <span id="debtor_member"><%= payment.debtor_member.member_name %></span>:
                    <%= payment.amount %>円
                    <%= link_to '編集', edit_payment_path(id: payment.payment_id) %>
                    <%= link_to '完了', payment_path(id: payment.payment_id), data: { turbo_method: :delete, turbo_confirm: "Are you sure?"} %>
                </div>
            <% end %>
        <% end %>
        <%= link_to '明細を記録する', payments_new_path(token: @group.token) %>
        <div>
            <button id="copy_url_button">URLをコピー</button>
        </div>
    </div>
    <script>
        // 支払い明細絞り込み
        document.addEventListener("turbo:load", function() {
            var selectElement = document.getElementById('members');
            var payments = document.querySelectorAll('.payment');

            selectElement.addEventListener('change', function() {
                var selectedMember = selectElement.value;

                payments.forEach(function(payment) {
                    var creditorName = payment.querySelector('#creditor_member').innerText;
                    if (selectedMember === "" || creditorName === selectedMember) {
                        payment.style.display = 'block';
                    } else {
                        payment.style.display = 'none';
                    }
                });
            });
        });
    </script>
    <script>
        // URLコピー
        var copyButton = document.getElementById('copy_url_button')

        copyButton.addEventListener('click', function(){
            var currentUrl = window.location.href;

            navigator.clipboard.writeText(currentUrl).then(function(){
                alert('URLがクリップボードにコピーされました');
            }).catch(function(err){
                console.error('URLのコピーに失敗しました:',err);
            });
        });
    </script>
</body>
</html>
